<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä»Šæ—¥ã¯ä½•ãŒã‚ã£ãŸï¼Ÿ - å’Œã®æ­´å²å›å»Š</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Shippori+Mincho+B1&display=swap" rel="stylesheet">
  <style>
    /* æ—¢å­˜ã®CSSã‚¹ã‚¿ã‚¤ãƒ«ã¯å¤‰æ›´ãªã— */
    :root {
      --bg-main: #fdfaf5;
      --text-main: #333;
      --accent: #b03a2e;
      --header-overlay: rgba(0, 0, 0, 0.5);
    }
    body.dark-mode {
      --bg-main: #1e1e1e;
      --text-main: #eee;
      --accent: #ff6347;
      --header-overlay: rgba(0, 0, 0, 0.6);
    }
    body {
      margin: 0;
      font-family: 'Noto Serif JP', serif;
      background-color: var(--bg-main);
      color: var(--text-main);
      transition: background-color 0.3s, color 0.3s;
    }
    header.hero {
      background-size: cover;
      background-position: center;
      height: 60vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      text-align: center;
    }
    header.hero .overlay {
      position: absolute;
      width: 100%; height: 100%;
      background: var(--header-overlay);
    }
    header.hero .hero-content {
      position: relative;
      color: #fff;
      z-index: 1;
    }
    header.hero h1 {
      font-family: 'Shippori Mincho B1', serif;
      font-size: 3em;
      margin: 0;
    }
    header.hero p {
      font-size: 1.2em;
      margin-top: 10px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    .section-title {
      font-size: 1.8em;
      margin-bottom: 20px;
      border-left: 5px solid var(--accent);
      padding-left: 10px;
      color: var(--accent);
    }
    .history-description p {
      margin-bottom: 1.5em;
      line-height: 1.8;
    }
    #resultList li {
      background-color: rgba(245, 242, 236, 0.9);
      padding: 15px;
      margin-bottom: 12px;
      border-left: 4px solid #888;
      border-radius: 4px;
    }
    body.dark-mode #resultList li {
      background-color: #2a2a2a;
    }
    #resultList img {
      max-width: 200px;
      margin-top: 10px;
      border-radius: 4px;
    }
    footer {
      text-align: center;
      background: #eae4dc;
      padding: 20px;
      font-size: 0.9em;
    }
    body.dark-mode footer {
      background: #2b2b2b;
    }
    button, input[type="date"], input[type="text"] { /* input[type="text"] ã‚’è¿½åŠ  */
      font-size: 1em;
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid #aaa;
      margin-top: 10px;
    }
    button {
      background-color: var(--accent);
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #922b21;
    }
    #themeToggle {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 6px 12px;
      z-index: 999;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    /* ã“ã“ã‹ã‚‰è¿½åŠ ã™ã‚‹CSSã‚¹ã‚¿ã‚¤ãƒ« */
    .filter-options button {
      margin-right: 10px;
      padding: 8px 15px;
      background-color: #ccc;
      color: #333;
      border: 1px solid #999;
    }
    .filter-options button.active {
      background-color: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    #dailyPerson, #triviaSection {
      background-color: rgba(245, 242, 236, 0.7);
      padding: 20px;
      margin-top: 40px;
      border-radius: 8px;
    }
    body.dark-mode #dailyPerson, body.dark-mode #triviaSection {
      background-color: #2a2a2a;
    }
    #dailyPerson h3, #triviaSection h3 {
      color: var(--accent);
      margin-top: 0;
    }
    #dailyPerson p, #triviaSection p {
      line-height: 1.6;
    }
    #dailyPerson img {
      max-width: 150px;
      height: auto;
      border-radius: 50%; /* ä¸¸ã„ç”»åƒ */
      float: right; /* ãƒ†ã‚­ã‚¹ãƒˆã®å³ã«é…ç½® */
      margin-left: 20px;
      margin-bottom: 10px;
    }
    #searchResultList li {
      background-color: rgba(245, 242, 236, 0.9);
      padding: 15px;
      margin-bottom: 12px;
      border-left: 4px solid #b03a2e; /* æ¤œç´¢çµæœã¯å¼·èª¿ */
      border-radius: 4px;
    }
    body.dark-mode #searchResultList li {
      background-color: #2a2a2a;
    }
  </style>
</head>
<body>
  <button id="themeToggle">ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</button>
  <header class="hero" id="hero">
    <div class="overlay"></div>
    <div class="hero-content">
      <h1>ä»Šæ—¥ã¯ä½•ãŒã‚ã£ãŸï¼Ÿ</h1>
      <p>æ‚ ä¹…ã®æ­´å²ã‚’æ—…ã—ã‚ˆã†</p>
    </div>
  </header>

  <div class="container">
    <section class="history-description">
      <h2 class="section-title">æ­´å²ã¨ã¯ä½•ã‹</h2>
      <p>æ­´å²ã¨ã¯ã€å˜ã«éå»ã®å‡ºæ¥äº‹ã‚’è¨˜éŒ²ã—ãŸã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãã‚Œã¯äººã€…ã®é¸æŠã€æ–‡åŒ–ã€æŠ€è¡“ã€ä¿¡å¿µã®ç©ã¿é‡ã­ãŒç¹”ã‚Šãªã™å£®å¤§ãªç‰©èªã§ã™ã€‚æ­´å²ã‚’å­¦ã¶ã“ã¨ã¯ã€ä»Šã‚’è¦‹ã¤ã‚ç›´ã—ã€æœªæ¥ã‚’æãåŠ›ã¨ãªã‚Šã¾ã™ã€‚</p>
      <p>å¤ä»£æ–‡æ˜ã®èˆˆéš†ã€ä¸­ä¸–ã®å®—æ•™æ”¹é©ã€ç”£æ¥­é©å‘½ã€ãã—ã¦ç¾ä»£ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ç¤¾ä¼šã®å½¢æˆã€‚ã‚ã‚‰ã‚†ã‚‹æ™‚ä»£ã«äººé¡ã¯æŒ‘æˆ¦ã—ã€è‘›è—¤ã—ã€å‰é€²ã—ã¦ãã¾ã—ãŸã€‚ãã®ç—•è·¡ãŒä»Šã‚’æ”¯ãˆã‚‹åŸºç›¤ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã™ã€‚</p>
      <p>ã“ã®ã‚µã‚¤ãƒˆã§ã¯ã€ç‰¹å®šã®æ—¥ä»˜ã«èµ·ã“ã£ãŸé‡è¦ãªæ­´å²çš„å‡ºæ¥äº‹ã‚’é€šã˜ã¦ã€éå»ã¨ç¾åœ¨ã®ã¤ãªãŒã‚Šã‚’æ„Ÿã˜ã¦ã„ãŸã ã‘ã‚‹ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ã€‚</p>
    </section>

    <section id="dailyPerson">
      <h2 class="section-title">ä»Šæ—¥ã®äººç‰©</h2>
      <div id="dailyPersonContent">
        <p>èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    </section>

    <section id="triviaSection">
      <h2 class="section-title">æ­´å²ã®è±†çŸ¥è­˜</h2>
      <div id="triviaContent">
        <p>èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    </section>

    <section>
      <h2 class="section-title">æ—¥ä»˜ã‚’é¸ã‚“ã§å‡ºæ¥äº‹ã‚’è¡¨ç¤º</h2>
      <input type="date" id="dateInput">
      <button onclick="getEvents()">å–å¾—</button>

      <div class="filter-options" style="margin-top: 15px;">
        <button data-filter="all" class="active">å…¨ã¦</button>
        <button data-filter="events">å‡ºæ¥äº‹</button>
        <button data-filter="births">èª•ç”Ÿæ—¥</button>
        <button data-filter="deaths">å‘½æ—¥</button>
      </div>
      <ul id="resultList"></ul>
    </section>

    <section>
      <h2 class="section-title">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ­´å²ã‚’æ¤œç´¢</h2>
      <input type="text" id="searchInput" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
      <button onclick="searchHistory()">æ¤œç´¢</button>
      <ul id="searchResultList"></ul>
    </section>

  </div>

  <footer>
    &copy; 2025 å’Œã®æ­´å²å›å»Š | å‡ºå…¸ï¼šWikipedia API | å†™çœŸï¼šPixabay
  </footer>

  <script>
    // æ—¢å­˜ã®JavaScriptã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ãªã—
    const heroImages = [
      'https://cdn.pixabay.com/photo/2017/08/06/22/01/japanese-garden-2599983_1280.jpg',
      'https://cdn.pixabay.com/photo/2016/08/11/18/06/shrine-1585655_1280.jpg',
      'https://cdn.pixabay.com/photo/2020/01/12/11/35/temple-4758959_1280.jpg'
    ];
    let currentImageIndex = 0;

    function rotateHeroImage() {
      const hero = document.getElementById('hero');
      hero.style.backgroundImage = `url('${heroImages[currentImageIndex]}')`;
      currentImageIndex = (currentImageIndex + 1) % heroImages.length;
    }
    rotateHeroImage();
    setInterval(rotateHeroImage, 10000);

    document.getElementById('themeToggle').addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
    });

    let currentEventsData = null; // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç”¨
    let currentFilter = 'all'; // ç¾åœ¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çŠ¶æ…‹

    // æ—¥ä»˜æŒ‡å®šã«ã‚ˆã‚‹å‡ºæ¥äº‹å–å¾—ï¼ˆå¤‰æ›´ã‚ã‚Šï¼šãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½è¿½åŠ ï¼‰
    async function getEvents() {
      const dateInput = document.getElementById('dateInput');
      const date = new Date(dateInput.value);
      if (isNaN(date.getTime())) { // ç„¡åŠ¹ãªæ—¥ä»˜ã®å ´åˆ
        document.getElementById('resultList').innerHTML = '<li>æœ‰åŠ¹ãªæ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</li>';
        return;
      }
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const url = `https://api.wikimedia.org/feed/v1/wikipedia/ja/onthisday/all/${month}/${day}`;

      try {
        document.getElementById('resultList').innerHTML = '<li>èª­ã¿è¾¼ã¿ä¸­...</li>';
        const response = await fetch(url, {
          headers: {
            'User-Agent': 'HistoricalWebApp (example@example.com)'
          }
        });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        currentEventsData = data; // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        displayEvents(currentEventsData, currentFilter); // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨ã—ã¦è¡¨ç¤º

        // æ—¥ä»˜ãŒé¸æŠã•ã‚ŒãŸã‚‰ã€ä»Šæ—¥ã®äººç‰©ã¨è±†çŸ¥è­˜ã‚‚æ›´æ–°
        displayDailyPersonAndTrivia(data);

      } catch (error) {
        console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        document.getElementById('resultList').innerHTML = '<li>ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</li>';
        currentEventsData = null;
      }
    }

    // å‡ºæ¥äº‹ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°ï¼ˆæ–°è¦è¿½åŠ ï¼‰
    function displayEvents(data, filterType) {
      const resultList = document.getElementById('resultList');
      resultList.innerHTML = '';

      let filteredEvents = [];
      if (filterType === 'all') {
        filteredEvents = [...data.events, ...data.births, ...data.deaths];
      } else {
        filteredEvents = data[filterType] || [];
      }

      if (filteredEvents.length === 0) {
        resultList.innerHTML = '<li>ã“ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã§ã¯å‡ºæ¥äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</li>';
        return;
      }

      filteredEvents.sort((a, b) => a.year - b.year); // å¹´ä»£é †ã«ã‚½ãƒ¼ãƒˆ

      filteredEvents.forEach(item => {
        const li = document.createElement('li');
        let typeText = '';
        if (data.events.includes(item)) typeText = 'ã€å‡ºæ¥äº‹ã€‘';
        else if (data.births.includes(item)) typeText = 'ã€èª•ç”Ÿæ—¥ã€‘';
        else if (data.deaths.includes(item)) typeText = 'ã€å‘½æ—¥ã€‘';

        li.innerHTML = `<strong>${item.year}å¹´:</strong> ${typeText} ${item.text}`;

        if (item.pages && item.pages[0].thumbnail && item.pages[0].thumbnail.source) {
          const img = document.createElement('img');
          img.src = item.pages[0].thumbnail.source;
          img.alt = item.pages[0].title;
          li.appendChild(img);
        }
        resultList.appendChild(li);
      });
    }

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆæ–°è¦è¿½åŠ ï¼‰
    document.querySelectorAll('.filter-options button').forEach(button => {
      button.addEventListener('click', function() {
        // å…¨ã¦ã®ãƒœã‚¿ãƒ³ã‹ã‚‰activeã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
        document.querySelectorAll('.filter-options button').forEach(btn => btn.classList.remove('active'));
        // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã«activeã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
        this.classList.add('active');

        currentFilter = this.dataset.filter;
        if (currentEventsData) {
          displayEvents(currentEventsData, currentFilter);
        } else {
          document.getElementById('resultList').innerHTML = '<li>æ—¥ä»˜ã‚’é¸æŠã—ã¦å‡ºæ¥äº‹ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„ã€‚</li>';
        }
      });
    });

    // ä»Šæ—¥ã®äººç‰©ã¨è±†çŸ¥è­˜ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°ï¼ˆæ–°è¦è¿½åŠ ï¼‰
    function displayDailyPersonAndTrivia(data) {
      const dailyPersonContent = document.getElementById('dailyPersonContent');
      const triviaContent = document.getElementById('triviaContent');
      dailyPersonContent.innerHTML = '';
      triviaContent.innerHTML = '';

      // ä»Šæ—¥ã®äººç‰© (èª•ç”Ÿæ—¥ã€å‘½æ—¥ã®è‘—åäººã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«1äººé¸å®š)
      const notablePeople = [...data.births, ...data.deaths].filter(item => item.pages && item.pages[0].description);
      if (notablePeople.length > 0) {
        const person = notablePeople[Math.floor(Math.random() * notablePeople.length)];
        let description = person.pages[0].extract || person.pages[0].description || 'èª¬æ˜ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚';
        // æŠ½å‡ºãŒé•·ã™ãã‚‹å ´åˆã€æœ€åˆã®æ•°æ–‡ã«çŸ­ç¸®
        if (description.length > 300) {
            description = description.substring(0, description.indexOf('.', 200) + 1 || 300) + '...';
        }

        dailyPersonContent.innerHTML = `
          ${person.pages[0].thumbnail ? `<img src="${person.pages[0].thumbnail.source}" alt="${person.pages[0].title}">` : ''}
          <h3>${person.pages[0].title} (${person.year}å¹´ ${data.births.includes(person) ? 'èª•ç”Ÿ' : 'æ­»å»'})</h3>
          <p>${description} <a href="https://ja.wikipedia.org/wiki/${encodeURIComponent(person.pages[0].title)}" target="_blank" rel="noopener noreferrer">ã‚‚ã£ã¨èª­ã‚€</a></p>
        `;
      } else {
        dailyPersonContent.innerHTML = '<p>ã“ã®æ—¥ã®è‘—åãªäººç‰©ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
      }

      // æ­´å²ã®è±†çŸ¥è­˜ (å‡ºæ¥äº‹ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤é¸å®š)
      if (data.events.length > 0) {
        const trivia = data.events[Math.floor(Math.random() * data.events.length)];
        triviaContent.innerHTML = `
          <h3>${trivia.year}å¹´ã®å‡ºæ¥äº‹ã‹ã‚‰</h3>
          <p>${trivia.text} <a href="https://ja.wikipedia.org/wiki/${encodeURIComponent(trivia.pages[0].title || trivia.text.split(' ')[0])}" target="_blank" rel="noopener noreferrer">è©³ç´°</a></p>
        `;
      } else {
        triviaContent.innerHTML = '<p>ã“ã®æ—¥ã®è±†çŸ¥è­˜ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
      }
    }


    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢æ©Ÿèƒ½ï¼ˆæ–°è¦è¿½åŠ ï¼‰
    async function searchHistory() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      const searchResultList = document.getElementById('searchResultList');
      searchResultList.innerHTML = '';

      if (!searchTerm) {
        searchResultList.innerHTML = '<li>æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</li>';
        return;
      }

      // Wikipedia APIã®æ¤œç´¢ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨
      const url = `https://ja.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(searchTerm)}&format=json&origin=*`;

      try {
        searchResultList.innerHTML = '<li>æ¤œç´¢ä¸­...</li>';
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();

        if (data.query.search.length === 0) {
          searchResultList.innerHTML = '<li>è©²å½“ã™ã‚‹é …ç›®ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</li>';
          return;
        }

        data.query.search.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `
            <a href="https://ja.wikipedia.org/wiki/${encodeURIComponent(item.title)}" target="_blank" rel="noopener noreferrer">
              <strong>${item.title}</strong>
            </a>
            <p>${item.snippet}...</p>
            <p style="font-size: 0.8em; color: #666;">ï¼ˆæœ€çµ‚æ›´æ–°æ—¥: ${new Date(item.timestamp).toLocaleDateString('ja-JP')})</p>
          `;
          searchResultList.appendChild(li);
        });

      } catch (error) {
        console.error('æ¤œç´¢ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        searchResultList.innerHTML = '<li>æ¤œç´¢ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</li>';
      }
    }

    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ä»Šæ—¥ã®å‡ºæ¥äº‹ã‚’è‡ªå‹•è¡¨ç¤º
    window.onload = () => {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      document.getElementById('dateInput').value = `${year}-${month}-${day}`;
      getEvents(); // ä»Šæ—¥ã®å‡ºæ¥äº‹ã‚’è‡ªå‹•çš„ã«å–å¾—
    };

  </script>
</body>
</html>
